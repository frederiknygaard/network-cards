(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{24:function(e,t,n){e.exports=n(44)},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(19),i=n.n(r),l=(n(29),n(5)),c=n(6),s=n(8),u=n(7),m=n(9),d=n(12),h=n(10),f=(n(30),n(31),o.a.createContext({token:null,userId:null,login:function(e){},logout:function(){}})),E=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={isLogin:!0},n.swichModeHandler=function(){n.setState((function(e){return{isLogin:!e.isLogin}}))},n.submitHandler=function(e){e.preventDefault();var t=n.emailElm.current.value,a=n.passwordElm.current.value;if(0!==t.trim().length&&0!==a.trim().length){var o={query:'\n        query {\n          login(email: "'.concat(t,'", password: "').concat(a,'") {\n            userId\n            token\n            tokenExpiration\n          }\n        }\n      ')};n.state.isLogin||(o={query:'\n          mutation {\n            createUser(userInput: {email: "'.concat(t,'", password: "').concat(a,'"}) {\n              _id\n              email\n            }\n          }\n        ')}),fetch("/.netlify/functions/graphql",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){console.log(e),e.data.login.token&&n.context.login(e.data.login)})).catch((function(e){console.log(e)}))}},n.emailElm=o.a.createRef(),n.passwordElm=o.a.createRef(),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("form",{className:"o-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"o-form__control"},o.a.createElement("label",{htmlFor:"email"},"Email"),o.a.createElement("input",{type:"email",id:"email",ref:this.emailElm})),o.a.createElement("div",{className:"o-form__control"},o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"password",id:"password",ref:this.passwordElm})),o.a.createElement("div",{className:"o-form__actions"},o.a.createElement("button",{type:"submit"},"Submit"),o.a.createElement("button",{type:"button",onClick:this.swichModeHandler},"Switch to ",this.state.isLogin?"Signup":"Login")))}}]),t}(a.Component);E.contextType=f;var p=E,v=n(20),g=n(23),b=(n(32),function(e){return o.a.createElement("div",{className:"modal"},o.a.createElement("header",{className:"modal__header"},o.a.createElement("h1",null,e.title)),o.a.createElement("section",{className:"modal__content"},e.children),o.a.createElement("section",{className:"modal__actions"},e.canCancel&&o.a.createElement("button",{onClick:e.onCancel,className:"button"},"Cancel"),e.canConfirm&&o.a.createElement("button",{onClick:e.onConfirm,className:"button"},e.confirmText)))}),k=(n(33),function(e){return o.a.createElement("div",{className:"backdrop"})}),y=(n(34),function(e){return o.a.createElement("div",{className:"events-list__item"},o.a.createElement("div",{key:e.id},o.a.createElement("h1",null,e.title),o.a.createElement("h2",null,e.price," - ",new Date(e.date).toLocaleDateString())),o.a.createElement("div",null,e.authUserId!==e.creatorId&&o.a.createElement("button",{onClick:e.onDetail.bind(void 0,e.id),className:"button"},"View Details"),e.authUserId===e.creatorId&&o.a.createElement("p",null,"You're the owner of this event")))}),O=(n(35),function(e){var t=e.events.map((function(t){return o.a.createElement(y,{authUserId:e.authUserId,creatorId:t.creator._id,key:t._id,id:t._id,title:t.title,price:t.price,date:t.date,onDetail:e.onViewDetail})}));return o.a.createElement("div",{className:"events-list"},t)});n(36);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var w=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},n.isActive=!0,n.startCreateEventHandler=function(){n.setState({creating:!0})},n.modalConfirmHandler=function(){n.setState({creating:!1});var e=n.titleElm.current.value,t=+n.priceElm.current.value,a=n.dateElm.current.value,o=n.descriptionElm.current.value;if(!(0===e.trim().length||t<=0||0===a.trim().length||0===o.trim().length)){var r={query:'\n        mutation {\n          createEvent(eventInput: {title: "'.concat(e,'", price: ').concat(t,', date: "').concat(a,'", description: "').concat(o,'"}) {\n            _id\n            title\n            description\n            price\n            date\n          }\n        }\n      ')},i=n.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){n.setState((function(t){var a=Object(g.a)(t.events);return a.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.data.createEvent,{creator:{_id:n.context.userId}})),{events:a}}))})).catch((function(e){console.log(e)}))}},n.modalCancelHandler=function(){n.setState({creating:!1,selectedEvent:null})},n.bookEventHandler=function(){if(n.context.token){var e={query:'\n        mutation {\n          bookEvent(eventId: "'.concat(n.state.selectedEvent._id,'") {\n            _id\n            createdAt\n            updatedAt\n          }\n        }\n      ')},t=n.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){console.log(e),n.setState({selectedEvent:null})})).catch((function(e){console.log(e)}))}else n.setState({selectedEvent:null})},n.showDetailHandler=function(e){console.log(e),n.setState((function(t){return{selectedEvent:t.events.find((function(t){return t._id===e}))}}))},n.titleElm=o.a.createRef(),n.priceElm=o.a.createRef(),n.dateElm=o.a.createRef(),n.descriptionElm=o.a.createRef(),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          events {\n            _id\n            title\n            description\n            date\n            price\n            creator {\n              _id\n              email\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(t){var n=t.data.events;e.isActive&&e.setState({events:n,isLoading:!1})})).catch((function(t){console.log(t),e.isActive&&e.setState({isLoading:!1})}))}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&o.a.createElement(k,null),this.state.creating&&o.a.createElement(o.a.Fragment,null,o.a.createElement(b,{title:"Add Event",confirmText:"Confirm",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler},o.a.createElement("form",{className:"o-form"},o.a.createElement("div",{className:"o-form__control"},o.a.createElement("label",{htmlFor:"title"},"Title"),o.a.createElement("input",{type:"text",id:"title",ref:this.titleElm})),o.a.createElement("div",{className:"o-form__control"},o.a.createElement("label",{htmlFor:"price"},"Price"),o.a.createElement("input",{type:"number",id:"price",ref:this.priceElm})),o.a.createElement("div",{className:"o-form__control"},o.a.createElement("label",{htmlFor:"date"},"Date"),o.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateElm})),o.a.createElement("div",{className:"o-form__control"},o.a.createElement("label",{htmlFor:"description"},"Description"),o.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionElm}))))),this.context.token&&o.a.createElement("div",{className:"events-control"},o.a.createElement("p",null,"Share your own events"),o.a.createElement("button",{onClick:this.startCreateEventHandler,className:"button"},"Create Event")),this.state.isLoading?o.a.createElement("p",null,"Loading..."):o.a.createElement(O,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler}),this.state.selectedEvent&&o.a.createElement(b,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},o.a.createElement("h1",null,this.state.selectedEvent.title),o.a.createElement("h2",null,this.state.selectedEvent.price," - ",new Date(this.state.selectedEvent.date).toLocaleDateString()),o.a.createElement("p",null,this.state.selectedEvent.description)))}}]),t}(a.Component);w.contextType=f;var _=w,j=(n(37),function(e){return o.a.createElement("ul",{className:"bookings"},e.bookings.map((function(t){return o.a.createElement("li",{key:t._id,className:"bookings__item"},o.a.createElement("div",null,o.a.createElement("h1",null,t.event.title),o.a.createElement("p",null,new Date(t.createdAt).toLocaleDateString())),o.a.createElement("div",null,o.a.createElement("button",{onClick:e.onCancel.bind(void 0,t._id),className:"button"},"Cancel")))})))}),S=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={isLoading:!1,bookings:[]},n.onCancel=function(e){n.setState({isLoading:!0});var t={query:"\n        mutation CancelBooking($id: ID!) {\n          cancelBooking(bookingId: $id ) {\n            _id\n            title\n          }\n        }\n      ",variables:{id:e}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(t){n.setState((function(t){return{bookings:t.bookings.filter((function(t){return t._id!==e})),isLoading:!1}}))})).catch((function(e){console.log(e),n.setState({isLoading:!1})}))},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"fetchBookings",value:function(){var e=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          bookings {\n            _id\n            createdAt\n            event {\n              _id\n              title\n              date\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.context.token)}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(t){console.log(t);var n=t.data.bookings;e.setState({bookings:n,isLoading:!1})})).catch((function(t){console.log(t),e.setState({isLoading:!1})}))}},{key:"render",value:function(){return console.log(this.state.bookings),o.a.createElement("div",null,o.a.createElement(j,{bookings:this.state.bookings,onCancel:this.onCancel}))}}]),t}(a.Component);S.contextType=f;var N=S,x=(n(38),function(e){return o.a.createElement(f.Consumer,null,(function(e){return o.a.createElement("header",{className:"h-header"},o.a.createElement("div",{className:"o-nav"},o.a.createElement("div",{className:"o-nav__logo"},o.a.createElement("h1",null,"Event Booking")),o.a.createElement("div",{className:"o-nav__items"},o.a.createElement("ul",null,!e.token&&o.a.createElement("li",null,o.a.createElement(d.b,{to:"/auth/"},"Login")),o.a.createElement("li",null,o.a.createElement(d.b,{to:"/events/"},"Events")),e.token&&o.a.createElement(o.a.Fragment,null,o.a.createElement("li",null,o.a.createElement(d.b,{to:"/bookings/"},"Bookings")),o.a.createElement("li",null,o.a.createElement("button",{onClick:e.logout},"Logout")))))))}))}),I=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={token:null,userId:null},n.login=function(e){n.setState({token:e.token,userId:e.userId})},n.logout=function(e){n.setState({token:null,userId:null})},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(d.a,null,o.a.createElement(f.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},o.a.createElement(x,null),o.a.createElement("main",{className:"h-main"},o.a.createElement(h.d,null,this.state.token&&o.a.createElement(h.a,{exact:!0,from:"/",to:"/events/"}),this.state.token&&o.a.createElement(h.a,{exact:!0,from:"/auth",to:"/events/"}),!this.state.token&&o.a.createElement(h.b,{path:"/auth/",component:p}),o.a.createElement(h.b,{path:"/events/",component:_}),this.state.token&&o.a.createElement(h.b,{path:"/bookings/",component:N}),!this.state.token&&o.a.createElement(h.a,{exact:!0,to:"/auth/"})))))}}]),t}(a.Component);i.a.render(o.a.createElement(I,null),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.31190973.chunk.js.map